"use strict";

var _e2fcrwler = require("./e2fcrwler");

//jshint esversion: 6
var cron = require("node-cron");

var express = require("express");

var fs = require("fs");

var datstore = require('../../radharani/e2fdatastore'); //require("babel-core/register");
//require("babel-polyfill");


var uuidv4 = require('uuid/v4');

var moment = require('moment');

//import { loggers } from 'winston';
var app = express();

function startProcess() {
  _e2fcrwler.Logger.log('info', "Starting process ...");

  var e2fcrawler = new _e2fcrwler.E2FCrawler({
    url: '',
    output: 'json'
  });
  var response = e2fcrawler.postData({
    url: 'https://expressdev.ease2fly.com/api/destinations/get-destinations-list',
    data: {
      usrId: 109,
      usrType: "N"
    }
  });
  response.then(function (data) {
    _e2fcrwler.Logger.log("info", JSON.stringify(data.result));

    _e2fcrwler.Logger.log('info', JSON.stringify(e2fcrawler.finalData));

    var runid = "".concat(uuidv4(), "_").concat(moment().format("DD-MMM-YYYY HH:mm:ss.SSS"));
    datstore.saveCircleBatchData(runid, e2fcrawler.finalData, "", function (rrid) {
      datstore.finalization(rrid, function () {
        _e2fcrwler.Logger.log('info', 'Finished');

        process.removeAllListeners("unhandledRejection");
        process.removeAllListeners('exit');
        process.removeAllListeners();
        return;
      });
      return;
    });
  }).catch(function (error) {
    _e2fcrwler.Logger.log("error", error);
  });
}

var excutionStarted = false;
cron.schedule("*/10 * * * *", function () {
  _e2fcrwler.Logger.log("info", "Cron started");

  if (excutionStarted) {
    _e2fcrwler.Logger.log("info", 'Previous process still running ...');

    return false;
  }

  try {
    excutionStarted = true;
    process.on('unhandledRejection', function (reason, promise) {
      _e2fcrwler.Logger.log('info', 'Unhandled Rejection at:', reason);
    });
    startProcess();
  } catch (e) {
    _e2fcrwler.Logger.log('error', e);
  } finally {
    excutionStarted = false;
  }
});
app.listen("3232");
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lMmYvaW5kZXhlMmYuanMiXSwibmFtZXMiOlsiY3JvbiIsInJlcXVpcmUiLCJleHByZXNzIiwiZnMiLCJkYXRzdG9yZSIsInV1aWR2NCIsIm1vbWVudCIsImFwcCIsInN0YXJ0UHJvY2VzcyIsIkxvZ2dlciIsImxvZyIsImUyZmNyYXdsZXIiLCJFMkZDcmF3bGVyIiwidXJsIiwib3V0cHV0IiwicmVzcG9uc2UiLCJwb3N0RGF0YSIsImRhdGEiLCJ1c3JJZCIsInVzclR5cGUiLCJ0aGVuIiwiSlNPTiIsInN0cmluZ2lmeSIsInJlc3VsdCIsImZpbmFsRGF0YSIsInJ1bmlkIiwiZm9ybWF0Iiwic2F2ZUNpcmNsZUJhdGNoRGF0YSIsInJyaWQiLCJmaW5hbGl6YXRpb24iLCJwcm9jZXNzIiwicmVtb3ZlQWxsTGlzdGVuZXJzIiwiY2F0Y2giLCJlcnJvciIsImV4Y3V0aW9uU3RhcnRlZCIsInNjaGVkdWxlIiwib24iLCJyZWFzb24iLCJwcm9taXNlIiwiZSIsImxpc3RlbiJdLCJtYXBwaW5ncyI6Ijs7QUFXQTs7QUFYQTtBQUNBLElBQU1BLElBQUksR0FBR0MsT0FBTyxDQUFDLFdBQUQsQ0FBcEI7O0FBQ0EsSUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsU0FBRCxDQUF2Qjs7QUFDQSxJQUFNRSxFQUFFLEdBQUdGLE9BQU8sQ0FBQyxJQUFELENBQWxCOztBQUNBLElBQU1HLFFBQVEsR0FBR0gsT0FBTyxDQUFDLDhCQUFELENBQXhCLEMsQ0FDQTtBQUNBOzs7QUFFQSxJQUFNSSxNQUFNLEdBQUdKLE9BQU8sQ0FBQyxTQUFELENBQXRCOztBQUNBLElBQU1LLE1BQU0sR0FBR0wsT0FBTyxDQUFDLFFBQUQsQ0FBdEI7O0FBR0E7QUFFQSxJQUFJTSxHQUFHLEdBQUdMLE9BQU8sRUFBakI7O0FBRUEsU0FBU00sWUFBVCxHQUF3QjtBQUNwQkMsb0JBQU9DLEdBQVAsQ0FBVyxNQUFYLEVBQW1CLHNCQUFuQjs7QUFFQSxNQUFJQyxVQUFVLEdBQUcsSUFBSUMscUJBQUosQ0FBZTtBQUFDQyxJQUFBQSxHQUFHLEVBQUUsRUFBTjtBQUFVQyxJQUFBQSxNQUFNLEVBQUU7QUFBbEIsR0FBZixDQUFqQjtBQUNBLE1BQUlDLFFBQVEsR0FBR0osVUFBVSxDQUFDSyxRQUFYLENBQW9CO0FBQUNILElBQUFBLEdBQUcsRUFBRSx3RUFBTjtBQUFnRkksSUFBQUEsSUFBSSxFQUFFO0FBQ3JIQyxNQUFBQSxLQUFLLEVBQUUsR0FEOEc7QUFFckhDLE1BQUFBLE9BQU8sRUFBRTtBQUY0RztBQUF0RixHQUFwQixDQUFmO0FBS0FKLEVBQUFBLFFBQVEsQ0FBQ0ssSUFBVCxDQUFjLFVBQUFILElBQUksRUFBSTtBQUNsQlIsc0JBQU9DLEdBQVAsQ0FBVyxNQUFYLEVBQW1CVyxJQUFJLENBQUNDLFNBQUwsQ0FBZUwsSUFBSSxDQUFDTSxNQUFwQixDQUFuQjs7QUFFQWQsc0JBQU9DLEdBQVAsQ0FBVyxNQUFYLEVBQW1CVyxJQUFJLENBQUNDLFNBQUwsQ0FBZVgsVUFBVSxDQUFDYSxTQUExQixDQUFuQjs7QUFFQSxRQUFJQyxLQUFLLGFBQU1wQixNQUFNLEVBQVosY0FBa0JDLE1BQU0sR0FBR29CLE1BQVQsQ0FBZ0IsMEJBQWhCLENBQWxCLENBQVQ7QUFDQXRCLElBQUFBLFFBQVEsQ0FBQ3VCLG1CQUFULENBQTZCRixLQUE3QixFQUFvQ2QsVUFBVSxDQUFDYSxTQUEvQyxFQUEwRCxFQUExRCxFQUE4RCxVQUFTSSxJQUFULEVBQWU7QUFDekV4QixNQUFBQSxRQUFRLENBQUN5QixZQUFULENBQXNCRCxJQUF0QixFQUE0QixZQUFNO0FBQzlCbkIsMEJBQU9DLEdBQVAsQ0FBVyxNQUFYLEVBQW1CLFVBQW5COztBQUVBb0IsUUFBQUEsT0FBTyxDQUFDQyxrQkFBUixDQUEyQixvQkFBM0I7QUFDQUQsUUFBQUEsT0FBTyxDQUFDQyxrQkFBUixDQUEyQixNQUEzQjtBQUNBRCxRQUFBQSxPQUFPLENBQUNDLGtCQUFSO0FBQ0E7QUFDSCxPQVBEO0FBUUE7QUFDSCxLQVZEO0FBV0gsR0FqQkQsRUFpQkdDLEtBakJILENBaUJTLFVBQUFDLEtBQUssRUFBSTtBQUNkeEIsc0JBQU9DLEdBQVAsQ0FBVyxPQUFYLEVBQW9CdUIsS0FBcEI7QUFDSCxHQW5CRDtBQW9CSDs7QUFFRCxJQUFJQyxlQUFlLEdBQUcsS0FBdEI7QUFDQWxDLElBQUksQ0FBQ21DLFFBQUwsQ0FBYyxjQUFkLEVBQThCLFlBQVc7QUFDckMxQixvQkFBT0MsR0FBUCxDQUFXLE1BQVgsRUFBbUIsY0FBbkI7O0FBQ0EsTUFBR3dCLGVBQUgsRUFBb0I7QUFDaEJ6QixzQkFBT0MsR0FBUCxDQUFXLE1BQVgsRUFBbUIsb0NBQW5COztBQUNBLFdBQU8sS0FBUDtBQUNIOztBQUVELE1BQ0E7QUFDSXdCLElBQUFBLGVBQWUsR0FBRyxJQUFsQjtBQUNBSixJQUFBQSxPQUFPLENBQUNNLEVBQVIsQ0FBVyxvQkFBWCxFQUFpQyxVQUFDQyxNQUFELEVBQVNDLE9BQVQsRUFBcUI7QUFDbEQ3Qix3QkFBT0MsR0FBUCxDQUFXLE1BQVgsRUFBa0IseUJBQWxCLEVBQTZDMkIsTUFBN0M7QUFDSCxLQUZEO0FBR0E3QixJQUFBQSxZQUFZO0FBQ2YsR0FQRCxDQVFBLE9BQU0rQixDQUFOLEVBQVM7QUFDTDlCLHNCQUFPQyxHQUFQLENBQVcsT0FBWCxFQUFvQjZCLENBQXBCO0FBQ0gsR0FWRCxTQVdRO0FBQ0pMLElBQUFBLGVBQWUsR0FBRyxLQUFsQjtBQUNIO0FBQ0osQ0FyQkQ7QUF1QkEzQixHQUFHLENBQUNpQyxNQUFKLENBQVcsTUFBWCIsInNvdXJjZXNDb250ZW50IjpbIi8vanNoaW50IGVzdmVyc2lvbjogNlxyXG5jb25zdCBjcm9uID0gcmVxdWlyZShcIm5vZGUtY3JvblwiKTtcclxuY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoXCJleHByZXNzXCIpO1xyXG5jb25zdCBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcclxuY29uc3QgZGF0c3RvcmUgPSByZXF1aXJlKCcuLi8uLi9yYWRoYXJhbmkvZTJmZGF0YXN0b3JlJyk7XHJcbi8vcmVxdWlyZShcImJhYmVsLWNvcmUvcmVnaXN0ZXJcIik7XHJcbi8vcmVxdWlyZShcImJhYmVsLXBvbHlmaWxsXCIpO1xyXG5cclxuY29uc3QgdXVpZHY0ID0gcmVxdWlyZSgndXVpZC92NCcpO1xyXG5jb25zdCBtb21lbnQgPSByZXF1aXJlKCdtb21lbnQnKTtcclxuXHJcbmltcG9ydCB7TG9nZ2VyLCBFMkZDcmF3bGVyfSBmcm9tICcuL2UyZmNyd2xlcic7XHJcbi8vaW1wb3J0IHsgbG9nZ2VycyB9IGZyb20gJ3dpbnN0b24nO1xyXG5cclxubGV0IGFwcCA9IGV4cHJlc3MoKTtcclxuXHJcbmZ1bmN0aW9uIHN0YXJ0UHJvY2VzcygpIHtcclxuICAgIExvZ2dlci5sb2coJ2luZm8nLCBcIlN0YXJ0aW5nIHByb2Nlc3MgLi4uXCIpO1xyXG5cclxuICAgIGxldCBlMmZjcmF3bGVyID0gbmV3IEUyRkNyYXdsZXIoe3VybDogJycsIG91dHB1dDogJ2pzb24nfSk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBlMmZjcmF3bGVyLnBvc3REYXRhKHt1cmw6ICdodHRwczovL2V4cHJlc3NkZXYuZWFzZTJmbHkuY29tL2FwaS9kZXN0aW5hdGlvbnMvZ2V0LWRlc3RpbmF0aW9ucy1saXN0JywgZGF0YToge1xyXG4gICAgICAgIHVzcklkOiAxMDksXHJcbiAgICAgICAgdXNyVHlwZTogXCJOXCJcclxuICAgIH19KTtcclxuXHJcbiAgICByZXNwb25zZS50aGVuKGRhdGEgPT4ge1xyXG4gICAgICAgIExvZ2dlci5sb2coXCJpbmZvXCIsIEpTT04uc3RyaW5naWZ5KGRhdGEucmVzdWx0KSk7XHJcblxyXG4gICAgICAgIExvZ2dlci5sb2coJ2luZm8nLCBKU09OLnN0cmluZ2lmeShlMmZjcmF3bGVyLmZpbmFsRGF0YSkpO1xyXG5cclxuICAgICAgICBsZXQgcnVuaWQgPSBgJHt1dWlkdjQoKX1fJHttb21lbnQoKS5mb3JtYXQoXCJERC1NTU0tWVlZWSBISDptbTpzcy5TU1NcIil9YDtcclxuICAgICAgICBkYXRzdG9yZS5zYXZlQ2lyY2xlQmF0Y2hEYXRhKHJ1bmlkLCBlMmZjcmF3bGVyLmZpbmFsRGF0YSwgXCJcIiwgZnVuY3Rpb24ocnJpZCkge1xyXG4gICAgICAgICAgICBkYXRzdG9yZS5maW5hbGl6YXRpb24ocnJpZCwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgTG9nZ2VyLmxvZygnaW5mbycsICdGaW5pc2hlZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIHByb2Nlc3MucmVtb3ZlQWxsTGlzdGVuZXJzKFwidW5oYW5kbGVkUmVqZWN0aW9uXCIpO1xyXG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5yZW1vdmVBbGxMaXN0ZW5lcnMoJ2V4aXQnKTtcclxuICAgICAgICAgICAgICAgIHByb2Nlc3MucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgTG9nZ2VyLmxvZyhcImVycm9yXCIsIGVycm9yKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG52YXIgZXhjdXRpb25TdGFydGVkID0gZmFsc2U7XHJcbmNyb24uc2NoZWR1bGUoXCIqLzEwICogKiAqICpcIiwgZnVuY3Rpb24oKSB7XHJcbiAgICBMb2dnZXIubG9nKFwiaW5mb1wiLCBcIkNyb24gc3RhcnRlZFwiKTtcclxuICAgIGlmKGV4Y3V0aW9uU3RhcnRlZCkge1xyXG4gICAgICAgIExvZ2dlci5sb2coXCJpbmZvXCIsICdQcmV2aW91cyBwcm9jZXNzIHN0aWxsIHJ1bm5pbmcgLi4uJyk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHRyeVxyXG4gICAge1xyXG4gICAgICAgIGV4Y3V0aW9uU3RhcnRlZCA9IHRydWU7XHJcbiAgICAgICAgcHJvY2Vzcy5vbigndW5oYW5kbGVkUmVqZWN0aW9uJywgKHJlYXNvbiwgcHJvbWlzZSkgPT4ge1xyXG4gICAgICAgICAgICBMb2dnZXIubG9nKCdpbmZvJywnVW5oYW5kbGVkIFJlamVjdGlvbiBhdDonLCByZWFzb24pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHN0YXJ0UHJvY2VzcygpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2goZSkge1xyXG4gICAgICAgIExvZ2dlci5sb2coJ2Vycm9yJywgZSk7XHJcbiAgICB9XHJcbiAgICBmaW5hbGx5IHtcclxuICAgICAgICBleGN1dGlvblN0YXJ0ZWQgPSBmYWxzZTtcclxuICAgIH1cclxufSk7XHJcblxyXG5hcHAubGlzdGVuKFwiMzIzMlwiKTtcclxuIl19